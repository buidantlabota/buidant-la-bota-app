import { createClient } from "@supabase/supabase-js";
import { normalizePlace } from "../utils/normalization";
import * as dotenv from "dotenv";

dotenv.config({ path: ".env.local" });

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseKey) {
    console.error("Falten variables d'entorn (SUPABASE_URL o KEY)");
    process.exit(1);
}

const supabase = createClient(supabaseUrl, supabaseKey);

const RawCSV = `nom,comarca
"Abella de la Conca","Pallars Juss√†"
"Abrera","Baix Llobregat"
"√Äger","Noguera"
"Agramunt","Urgell"
"Aguilar de Segarra","Bages"
"Agullana","Alt Empord√†"
"Aiguafreda","Vall√®s Oriental"
"Aiguam√∫rcia","Alt Camp"
"Aiguaviva","Giron√®s"
"Aitona","Segri√†"
"Al√†s i Cerc","Alt Urgell"
"Albany√†","Alt Empord√†"
"Albat√†rrec","Segri√†"
"Albesa","Noguera"
"Albinyana","Baix Pened√®s"
"Albons","Baix Empord√†"
"Alcanar","Montsi√†"
"Alcan√≥","Segri√†"
"Alcarr√†s","Segri√†"
"Alcoletge","Segri√†"
"Alcover","Alt Camp"
"Aldover","Baix Ebre"
"Alella","Maresme"
"Alfara de Carles","Baix Ebre"
"Alfarr√†s","Segri√†"
"Alf√©s","Segri√†"
"Alforja","Baix Camp"
"Algerri","Noguera"
"Alguaire","Segri√†"
"Alins","Pallars Sobir√†"
"Ali√≥","Alt Camp"
"Almacelles","Segri√†"
"Almatret","Segri√†"
"Almenar","Segri√†"
"Almoster","Baix Camp"
"Al√≤s de Balaguer","Noguera"
"Alp","Cerdanya"
"Alpens","Osona"
"Alpicat","Segri√†"
"Alt √Äneu","Pallars Sobir√†"
"Altafulla","Tarragon√®s"
"Amer","Selva"
"Amposta","Montsi√†"
"Angl√®s","Selva"
"Anglesola","Urgell"
"Arbeca","Garrigues"
"Arbol√≠","Baix Camp"
"Arb√∫cies","Selva"
"Arenys de Mar","Maresme"
"Arenys de Munt","Maresme"
"Argelaguer","Garrotxa"
"Argen√ßola","Anoia"
"Argentona","Maresme"
"Arnes","Terra Alta"
"Arres","Val d'Aran"
"Ars√®guel","Alt Urgell"
"Art√©s","Bages"
"Artesa de Lleida","Segri√†"
"Artesa de Segre","Noguera"
"Asc√≥","Ribera d'Ebre"
"Aspa","Segri√†"
"Avi√†","Bergued√†"
"Aviny√≥","Bages"
"Avinyonet de Puigvent√≥s","Alt Empord√†"
"Avinyonet del Pened√®s","Alt Pened√®s"
"Badalona","Barcelon√®s"
"Badia del Vall√®s","Vall√®s Occidental"
"Bag√†","Bergued√†"
"Baix Pallars","Pallars Sobir√†"
"Balaguer","Noguera"
"Baleny√†","Osona"
"Balsareny","Bages"
"Banyeres del Pened√®s","Baix Pened√®s"
"Banyoles","Pla de l'Estany"
"Barbens","Pla d'Urgell"
"Barber√† de la Conca","Conca de Barber√†"
"Barber√† del Vall√®s","Vall√®s Occidental"
"Barcelona","Barcelon√®s"
"B√†scara","Alt Empord√†"
"Bassella","Alt Urgell"
"Batea","Terra Alta"
"Bausen","Val d'Aran"
"Begues","Baix Llobregat"
"Begur","Baix Empord√†"
"Belianes","Urgell"
"Bell-lloc d'Urgell","Pla d'Urgell"
"Bellaguarda","Garrigues"
"Bellcaire d'Empord√†","Baix Empord√†"
"Bellcaire d'Urgell","Noguera"
"Bellmunt d'Urgell","Noguera"
"Bellmunt del Priorat","Priorat"
"Bellprat","Anoia"
"Bellpuig","Urgell"
"Bellvei","Baix Pened√®s"
"Bellver de Cerdanya","Cerdanya"
"Bellv√≠s","Pla d'Urgell"
"Benavent de Segri√†","Segri√†"
"Benifallet","Baix Ebre"
"Benissanet","Ribera d'Ebre"
"Berga","Bergued√†"
"Besal√∫","Garrotxa"
"Bescan√≥","Giron√®s"
"Beuda","Garrotxa"
"Bigues i Riells","Vall√®s Oriental"
"Biosca","Segarra"
"Biure","Alt Empord√†"
"Blancafort","Conca de Barber√†"
"Blanes","Selva"
"Boadella i les Escaules","Alt Empord√†"
"Bolvir","Cerdanya"
"Bonastre","Baix Pened√®s"
"Bordils","Giron√®s"
"Borrass√†","Alt Empord√†"
"Borred√†","Bergued√†"
"Boss√≤st","Val d'Aran"
"Bot","Terra Alta"
"Botarell","Baix Camp"
"Bovera","Garrigues"
"Br√†fim","Alt Camp"
"Breda","Selva"
"Brunyola","Selva"
"Cabac√©s","Priorat"
"Cabanabona","Noguera"
"Cabanelles","Alt Empord√†"
"Cabanes","Alt Empord√†"
"Cab√≥","Alt Urgell"
"Cabra del Camp","Alt Camp"
"Cabrera d'Anoia","Anoia"
"Cabrera de Mar","Maresme"
"Cabrils","Maresme"
"Cadaqu√©s","Alt Empord√†"
"Calaf","Anoia"
"Calafell","Baix Pened√®s"
"Calders","Moian√®s"
"Caldes d'Estrac","Maresme"
"Caldes de Malavella","Selva"
"Caldes de Montbui","Vall√®s Oriental"
"Calella","Maresme"
"Calldetenes","Osona"
"Call√∫s","Bages"
"Calonge de Segarra","Anoia"
"Calonge i Sant Antoni","Baix Empord√†"
"Camarasa","Noguera"
"Camarles","Baix Ebre"
"Cambrils","Baix Camp"
"Cam√≥s","Pla de l'Estany"
"Campdev√†nol","Ripoll√®s"
"Campelles","Ripoll√®s"
"Campins","Vall√®s Oriental"
"Campllong","Giron√®s"
"Camprodon","Ripoll√®s"
"Canejan","Val d'Aran"
"Canet d'Adri","Giron√®s"
"Canet de Mar","Maresme"
"Canovelles","Vall√®s Oriental"
"C√†noves i Samal√∫s","Vall√®s Oriental"
"Cantallops","Alt Empord√†"
"Canyelles","Garraf"
"Capafonts","Baix Camp"
"Cap√ßanes","Priorat"
"Capellades","Anoia"
"Capmany","Alt Empord√†"
"Capolat","Bergued√†"
"Cardedeu","Vall√®s Oriental"
"Cardona","Bages"
"Carme","Anoia"
"Caseres","Terra Alta"
"Cass√† de la Selva","Giron√®s"
"Casserres","Bergued√†"
"Castell de l'Areny","Bergued√†"
"Castell de Mur","Pallars Juss√†"
"Castell-Platja d'Aro","Baix Empord√†"
"Castellar de la Ribera","Solson√®s"
"Castellar de n'Hug","Bergued√†"
"Castellar del Riu","Bergued√†"
"Castellar del Vall√®s","Vall√®s Occidental"
"Castellbell i el Vilar","Bages"
"Castellbisbal","Vall√®s Occidental"
"Castellcir","Moian√®s"
"Castelldans","Garrigues"
"Castelldefels","Baix Llobregat"
"Castellet i la Gornal","Alt Pened√®s"
"Castellfollit de la Roca","Garrotxa"
"Castellfollit de Riubreg√≥s","Anoia"
"Castellfollit del Boix","Bages"
"Castellgal√≠","Bages"
"Castellnou de Bages","Bages"
"Castellnou de Seana","Pla d'Urgell"
"Castell√≥ d'Emp√∫ries","Alt Empord√†"
"Castell√≥ de Farfanya","Noguera"
"Castellol√≠","Anoia"
"Castellser√†","Urgell"
"Castellter√ßol","Moian√®s"
"Castellvell del Camp","Baix Camp"
"Castellv√≠ de la Marca","Alt Pened√®s"
"Castellv√≠ de Rosanes","Baix Llobregat"
"Cava","Alt Urgell"
"Celr√†","Giron√®s"
"Centelles","Osona"
"Cercs","Bergued√†"
"Cerdanyola del Vall√®s","Vall√®s Occidental"
"Cervell√≥","Baix Llobregat"
"Cervera","Segarra"
"Cervi√† de les Garrigues","Garrigues"
"Cervi√† de Ter","Giron√®s"
"Cistella","Alt Empord√†"
"Ciutadilla","Urgell"
"Clariana de Cardener","Solson√®s"
"Colera","Alt Empord√†"
"Coll de Narg√≥","Alt Urgell"
"Collbat√≥","Baix Llobregat"
"Colldejou","Baix Camp"
"Collsuspina","Moian√®s"
"Colomers","Baix Empord√†"
"Conca de Dalt","Pallars Juss√†"
"Conesa","Conca de Barber√†"
"Constant√≠","Tarragon√®s"
"Copons","Anoia"
"Corbera d'Ebre","Terra Alta"
"Corbera de Llobregat","Baix Llobregat"
"Corbins","Segri√†"
"Cor√ß√†","Baix Empord√†"
"Cornell√† de Llobregat","Baix Llobregat"
"Cornell√† del Terri","Pla de l'Estany"
"Cornudella de Montsant","Priorat"
"Creixell","Tarragon√®s"
"Crespi√†","Pla de l'Estany"
"Cru√Ølles, Monells i Sant Sadurn√≠ de l'Heura","Baix Empord√†"
"Cubelles","Garraf"
"Cubells","Noguera"
"Cunit","Baix Pened√®s"
"Darnius","Alt Empord√†"
"Das","Cerdanya"
"Deltebre","Baix Ebre"
"Dosrius","Maresme"
"Duesaig√ºes","Baix Camp"
"El Bruc","Anoia"
"El Brull","Osona"
"El Catllar","Tarragon√®s"
"El Cogul","Garrigues"
"El Far d'Empord√†","Alt Empord√†"
"El Lloar","Priorat"
"El Masnou","Maresme"
"El Masroig","Priorat"
"El Mil√†","Alt Camp"
"El Molar","Priorat"
"El Montmell","Baix Pened√®s"
"El Morell","Tarragon√®s"
"El Palau d'Anglesola","Pla d'Urgell"
"El Papiol","Baix Llobregat"
"El Perell√≥","Baix Ebre"
"El Pinell de Brai","Terra Alta"
"El Pla de Santa Maria","Alt Camp"
"El Pla del Pened√®s","Alt Pened√®s"
"El Poal","Pla d'Urgell"
"El Pont d'Armentera","Alt Camp"
"El Pont de Bar","Alt Urgell"
"El Pont de Suert","Alta Ribagor√ßa"
"El Pont de Vilomara i Rocafort","Bages"
"El Port de la Selva","Alt Empord√†"
"El Prat de Llobregat","Baix Llobregat"
"El Rourell","Alt Camp"
"El Soler√†s","Garrigues"
"El Vendrell","Baix Pened√®s"
"El Vilosell","Garrigues"
"Els Alam√∫s","Segri√†"
"Els Garidells","Alt Camp"
"Els Guiamets","Priorat"
"Els Hostalets de Pierola","Anoia"
"Els Omellons","Garrigues"
"Els Omells de na Gaia","Urgell"
"Els Pallaresos","Tarragon√®s"
"Els Plans de Si√≥","Segarra"
"Els Prats de Rei","Anoia"
"Els Torms","Garrigues"
"Es B√≤rdes","Val d'Aran"
"Esparreguera","Baix Llobregat"
"Espinelves","Osona"
"Esplugues de Llobregat","Baix Llobregat"
"Espolla","Alt Empord√†"
"Esponell√†","Pla de l'Estany"
"Espot","Pallars Sobir√†"
"Estamariu","Alt Urgell"
"Estar√†s","Segarra"
"Esterri d'√Äneu","Pallars Sobir√†"
"Esterri de Card√≥s","Pallars Sobir√†"
"Falset","Priorat"
"Farrera","Pallars Sobir√†"
"Figar√≥-Montmany","Vall√®s Oriental"
"F√≠gols","Bergued√†"
"F√≠gols i Aliny√†","Alt Urgell"
"Figueres","Alt Empord√†"
"Figuerola del Camp","Alt Camp"
"Fla√ß√†","Giron√®s"
"Flix","Ribera d'Ebre"
"Fogars de la Selva","Selva"
"Fogars de Montcl√∫s","Vall√®s Oriental"
"Foix√†","Baix Empord√†"
"Folgueroles","Osona"
"Fondarella","Pla d'Urgell"
"Fonollosa","Bages"
"Font-rub√≠","Alt Pened√®s"
"Fontanals de Cerdanya","Cerdanya"
"Fontanilles","Baix Empord√†"
"Fontcoberta","Pla de l'Estany"
"Foradada","Noguera"
"Forallac","Baix Empord√†"
"For√®s","Conca de Barber√†"
"Fornells de la Selva","Giron√®s"
"Forti√†","Alt Empord√†"
"Freginals","Montsi√†"
"Fulleda","Garrigues"
"Gai√†","Bages"
"Gallifa","Vall√®s Occidental"
"Gandesa","Terra Alta"
"Garcia","Ribera d'Ebre"
"Garrig√†s","Alt Empord√†"
"Garrigoles","Baix Empord√†"
"Garriguella","Alt Empord√†"
"Gav√†","Baix Llobregat"
"Gavet de la Conca","Pallars Juss√†"
"Gelida","Alt Pened√®s"
"Ger","Cerdanya"
"Gimenells i el Pla de la Font","Segri√†"
"Ginestar","Ribera d'Ebre"
"Girona","Giron√®s"
"Gironella","Bergued√†"
"Gisclareny","Bergued√†"
"Godall","Montsi√†"
"Golm√©s","Pla d'Urgell"
"Gombr√®n","Ripoll√®s"
"G√≥sol","Bergued√†"
"Granera","Moian√®s"
"Granollers","Vall√®s Oriental"
"Granyanella","Segarra"
"Granyena de les Garrigues","Garrigues"
"Granyena de Segarra","Segarra"
"Gratallops","Priorat"
"Gualba","Vall√®s Oriental"
"Gualta","Baix Empord√†"
"Guardiola de Bergued√†","Bergued√†"
"Guils de Cerdanya","Cerdanya"
"Guimer√†","Urgell"
"Guissona","Segarra"
"Guixers","Solson√®s"
"Gurb","Osona"
"Horta de Sant Joan","Terra Alta"
"Hostalric","Selva"
"Igualada","Anoia"
"Isona i Conca Dell√†","Pallars Juss√†"
"Is√≤vol","Cerdanya"
"Ivars d'Urgell","Pla d'Urgell"
"Ivars de Noguera","Noguera"
"Ivorra","Segarra"
"Jafre","Baix Empord√†"
"Jorba","Anoia"
"Josa i Tuix√©n","Alt Urgell"
"Jui√†","Giron√®s"
"Juncosa","Garrigues"
"Juneda","Garrigues"
"L'Albag√©s","Garrigues"
"L'Albi","Garrigues"
"L'Albiol","Baix Camp"
"L'Aldea","Baix Ebre"
"L'Aleixar","Baix Camp"
"L'Ametlla de Mar","Baix Ebre"
"L'Ametlla del Vall√®s","Vall√®s Oriental"
"L'Ampolla","Baix Ebre"
"L'Arbo√ß","Baix Pened√®s"
"L'Argentera","Baix Camp"
"L'Armentera","Alt Empord√†"
"L'Escala","Alt Empord√†"
"L'Espluga Calba","Garrigues"
"L'Espluga de Francol√≠","Conca de Barber√†"
"L'Espunyola","Bergued√†"
"L'Esquirol","Osona"
"L'Estany","Moian√®s"
"L'Hospitalet de Llobregat","Barcelon√®s"
"La Baronia de Rialb","Noguera"
"La Bisbal d'Empord√†","Baix Empord√†"
"La Bisbal de Montsant","Priorat"
"La Bisbal del Pened√®s","Baix Pened√®s"
"La Canonja","Tarragon√®s"
"La Cellera de Ter","Selva"
"La Coma i la Pedra","Solson√®s"
"La Fatarella","Terra Alta"
"La Febr√≥","Baix Camp"
"La Figuera","Priorat"
"La Floresta","Garrigues"
"La Fuliola","Urgell"
"La Galera","Montsi√†"
"La Garriga","Vall√®s Oriental"
"La Granada","Alt Pened√®s"
"La Granadella","Garrigues"
"La Granja d'Escarp","Segri√†"
"La Guingueta d'√Äneu","Pallars Sobir√†"
"La Jonquera","Alt Empord√†"
"La Llacuna","Anoia"
"La Llagosta","Vall√®s Oriental"
"La Mas√≥","Alt Camp"
"La Molsosa","Solson√®s"
"La Morera de Montsant","Priorat"
"La Nou de Bergued√†","Bergued√†"
"La Nou de Gai√†","Tarragon√®s"
"La Palma d'Ebre","Ribera d'Ebre"
"La Palma de Cervell√≥","Baix Llobregat"
"La Pera","Baix Empord√†"
"La Pobla de C√©rvoles","Garrigues"
"La Pobla de Claramunt","Anoia"
"La Pobla de Lillet","Bergued√†"
"La Pobla de Mafumet","Tarragon√®s"
"La Pobla de Massaluca","Terra Alta"
"La Pobla de Montorn√®s","Tarragon√®s"
"La Pobla de Segur","Pallars Juss√†"
"La Portella","Segri√†"
"La Quar","Bergued√†"
"la R√†pita","Montsi√†"
"La Riba","Alt Camp"
"La Riera de Gai√†","Tarragon√®s"
"La Roca del Vall√®s","Vall√®s Oriental"
"La Secuita","Tarragon√®s"
"La Selva de Mar","Alt Empord√†"
"La Selva del Camp","Baix Camp"
"La S√©nia","Montsi√†"
"La Sentiu de Si√≥","Noguera"
"La Seu d'Urgell","Alt Urgell"
"La Tallada d'Empord√†","Baix Empord√†"
"La Torre de Capdella","Pallars Juss√†"
"La Torre de Claramunt","Anoia"
"La Torre de Fontaubella","Priorat"
"La Torre de l'Espanyol","Ribera d'Ebre"
"La Vajol","Alt Empord√†"
"La Vall d'en Bas","Garrotxa"
"La Vall de Bianya","Garrotxa"
"La Vall de Bo√≠","Alta Ribagor√ßa"
"La Vansa i F√≥rnols","Alt Urgell"
"La Vilella Alta","Priorat"
"La Vilella Baixa","Priorat"
"Les","Val d'Aran"
"Les Avellanes i Santa Linya","Noguera"
"Les Borges Blanques","Garrigues"
"Les Borges del Camp","Baix Camp"
"Les Cabanyes","Alt Pened√®s"
"Les Franqueses del Vall√®s","Vall√®s Oriental"
"Les Llosses","Ripoll√®s"
"Les Masies de Roda","Osona"
"Les Masies de Voltreg√†","Osona"
"Les Oluges","Segarra"
"Les Piles","Conca de Barber√†"
"Les Planes d'Hostoles","Garrotxa"
"Les Preses","Garrotxa"
"Les Valls d'Aguilar","Alt Urgell"
"Les Valls de Valira","Alt Urgell"
"Linyola","Pla d'Urgell"
"Llad√≥","Alt Empord√†"
"Lladorre","Pallars Sobir√†"
"Lladurs","Solson√®s"
"Llagostera","Giron√®s"
"Llambilles","Giron√®s"
"Llanars","Ripoll√®s"
"Llan√ß√†","Alt Empord√†"
"Llardecans","Segri√†"
"Llavors√≠","Pallars Sobir√†"
"Lleida","Segri√†"
"Llers","Alt Empord√†"
"Lles de Cerdanya","Cerdanya"
"Lli√ß√† d'Amunt","Vall√®s Oriental"
"Lli√ß√† de Vall","Vall√®s Oriental"
"Llimiana","Pallars Juss√†"
"Llinars del Vall√®s","Vall√®s Oriental"
"Ll√≠via","Cerdanya"
"Llobera","Solson√®s"
"Llorac","Conca de Barber√†"
"Lloren√ß del Pened√®s","Baix Pened√®s"
"Lloret de Mar","Selva"
"Llu√ß√†","Osona"
"Ma√ßanet de Cabrenys","Alt Empord√†"
"Ma√ßanet de la Selva","Selva"
"Madremanya","Giron√®s"
"Mai√† de Montcal","Garrotxa"
"Maials","Segri√†"
"Mald√†","Urgell"
"Malgrat de Mar","Maresme"
"Malla","Osona"
"Manlleu","Osona"
"Manresa","Bages"
"Mar√ß√†","Priorat"
"Margalef","Priorat"
"Marganell","Bages"
"Martorell","Baix Llobregat"
"Martorelles","Vall√®s Oriental"
"Mas de Barberans","Montsi√†"
"Masarac","Alt Empord√†"
"Masdenverge","Montsi√†"
"Maslloren√ß","Baix Pened√®s"
"Maspujols","Baix Camp"
"Masquefa","Anoia"
"Massalcoreig","Segri√†"
"Massanes","Selva"
"Massoteres","Segarra"
"Matadepera","Vall√®s Occidental"
"Matar√≥","Maresme"
"Mediny√†","Giron√®s"
"Mediona","Alt Pened√®s"
"Men√†rguens","Noguera"
"Meranges","Cerdanya"
"Mieres","Garrotxa"
"Miralcamp","Pla d'Urgell"
"Miravet","Ribera d'Ebre"
"Moi√†","Moian√®s"
"Molins de Rei","Baix Llobregat"
"Mollerussa","Pla d'Urgell"
"Mollet de Peralada","Alt Empord√†"
"Mollet del Vall√®s","Vall√®s Oriental"
"Moll√≥","Ripoll√®s"
"Monistrol de Calders","Moian√®s"
"Monistrol de Montserrat","Bages"
"Mont-ral","Alt Camp"
"Mont-ras","Baix Empord√†"
"Mont-roig del Camp","Baix Camp"
"Montagut i Oix","Garrotxa"
"Montblanc","Conca de Barber√†"
"Montbri√≥ del Camp","Baix Camp"
"Montcada i Reixac","Vall√®s Occidental"
"Montclar","Bergued√†"
"Montell√† i Martinet","Cerdanya"
"Montesquiu","Osona"
"Montferrer i Castellb√≤","Alt Urgell"
"Montferri","Alt Camp"
"Montgai","Noguera"
"Montferrer i Castellb√≤","Alt Urgell"
"Montferri","Alt Camp"
"Montgai","Noguera"
"Montgat","Maresme"
"Montmajor","Bergued√†"
"Montmaneu","Anoia"
"Montmel√≥","Vall√®s Oriental"
"Montoliu de Lleida","Segri√†"
"Montoliu de Segarra","Segarra"
"Montorn√®s de Segarra","Segarra"
"Montorn√®s del Vall√®s","Vall√®s Oriental"
"Montseny","Vall√®s Oriental"
"M√≥ra d'Ebre","Ribera d'Ebre"
"M√≥ra la Nova","Ribera d'Ebre"
"Muntanyola","Osona"
"Mura","Bages"
"Nalec","Urgell"
"Naut Aran","Val d'Aran"
"Navarcles","Bages"
"Nav√†s","Bages"
"Navata","Alt Empord√†"
"Nav√®s","Solson√®s"
"Nulles","Alt Camp"
"Od√®n","Solson√®s"
"√ídena","Anoia"
"Ogassa","Ripoll√®s"
"Ol√®rdola","Alt Pened√®s"
"Olesa de Bonesvalls","Alt Pened√®s"
"Olesa de Montserrat","Baix Llobregat"
"Oliana","Alt Urgell"
"Oliola","Noguera"
"Olius","Solson√®s"
"Olivella","Garraf"
"Olost","Osona"
"Olot","Garrotxa"
"Olvan","Bergued√†"
"Ordis","Alt Empord√†"
"Organy√†","Alt Urgell"
"Or√≠s","Osona"
"Orist√†","Osona"
"Orp√≠","Anoia"
"√írrius","Maresme"
"Os de Balaguer","Noguera"
"Osor","Selva"
"Oss√≥ de Si√≥","Urgell"
"Pacs del Pened√®s","Alt Pened√®s"
"Palafolls","Maresme"
"Palafrugell","Baix Empord√†"
"Palam√≥s","Baix Empord√†"
"Palau de Santa Eul√†lia","Alt Empord√†"
"Palau-sator","Baix Empord√†"
"Palau-saverdera","Alt Empord√†"
"Palau-solit√† i Plegamans","Vall√®s Occidental"
"Pallej√†","Baix Llobregat"
"Palol de Revardit","Pla de l'Estany"
"Pals","Baix Empord√†"
"Pardines","Ripoll√®s"
"Parets del Vall√®s","Vall√®s Oriental"
"Parlav√†","Baix Empord√†"
"Passanant i Belltall","Conca de Barber√†"
"Pau","Alt Empord√†"
"Pa√ºls","Baix Ebre"
"Pedret i Marz√†","Alt Empord√†"
"Penelles","Noguera"
"Perafita","Osona"
"Perafort","Tarragon√®s"
"Peralada","Alt Empord√†"
"Peramola","Alt Urgell"
"Piera","Anoia"
"Pineda de Mar","Maresme"
"Pinell de Solson√®s","Solson√®s"
"Pin√≥s","Solson√®s"
"Pira","Conca de Barber√†"
"Planoles","Ripoll√®s"
"Poboleda","Priorat"
"Poliny√†","Vall√®s Occidental"
"Pont de Molins","Alt Empord√†"
"Pontils","Conca de Barber√†"
"Pontons","Alt Pened√®s"
"Pont√≥s","Alt Empord√†"
"Ponts","Noguera"
"Porqueres","Pla de l'Estany"
"Porrera","Priorat"
"Portbou","Alt Empord√†"
"Pradell de la Teixeta","Priorat"
"Prades","Baix Camp"
"Prat de Comte","Terra Alta"
"Pratdip","Baix Camp"
"Prats de Llu√ßan√®s","Osona"
"Prats i Sansor","Cerdanya"
"Preixana","Urgell"
"Preixens","Noguera"
"Premi√† de Dalt","Maresme"
"Premi√† de Mar","Maresme"
"Prullans","Cerdanya"
"Puig-reig","Bergued√†"
"Puigcerd√†","Cerdanya"
"Puigd√†lber","Alt Pened√®s"
"Puiggr√≤s","Garrigues"
"Puigpelat","Alt Camp"
"Puigverd d'Agramunt","Urgell"
"Puigverd de Lleida","Segri√†"
"Pujalt","Anoia"
"Quart","Giron√®s"
"Queralbs","Ripoll√®s"
"Querol","Alt Camp"
"Rab√≥s","Alt Empord√†"
"Rajadell","Bages"
"Rasquera","Ribera d'Ebre"
"Regenc√≥s","Baix Empord√†"
"Rellinars","Vall√®s Occidental"
"Renau","Tarragon√®s"
"Reus","Baix Camp"
"Rialp","Pallars Sobir√†"
"Riba-roja d'Ebre","Ribera d'Ebre"
"Ribera d'Ondara","Segarra"
"Ribera d'Urgellet","Alt Urgell"
"Ribes de Freser","Ripoll√®s"
"Riells i Viabrea","Selva"
"Riner","Solson√®s"
"Ripoll","Ripoll√®s"
"Ripollet","Vall√®s Occidental"
"Riu de Cerdanya","Cerdanya"
"Riudarenes","Selva"
"Riudaura","Garrotxa"
"Riudecanyes","Baix Camp"
"Riudecols","Baix Camp"
"Riudellots de la Selva","Selva"
"Riudoms","Baix Camp"
"Riumors","Alt Empord√†"
"Rocafort de Queralt","Conca de Barber√†"
"Roda de Ber√†","Tarragon√®s"
"Roda de Ter","Osona"
"Rodony√†","Alt Camp"
"Roquetes","Baix Ebre"
"Roses","Alt Empord√†"
"Rossell√≥","Segri√†"
"Rub√≠","Vall√®s Occidental"
"Rubi√≥","Anoia"
"Rupi√†","Baix Empord√†"
"Rupit i Pruit","Osona"
"Sabadell","Vall√®s Occidental"
"Sag√†s","Bergued√†"
"Sal√†s de Pallars","Pallars Juss√†"
"Saldes","Bergued√†"
"Sales de Llierca","Garrotxa"
"Sallent","Bages"
"Salom√≥","Tarragon√®s"
"Salou","Tarragon√®s"
"Salt","Giron√®s"
"Sana√ºja","Segarra"
"Sant Adri√† de Bes√≤s","Barcelon√®s"
"Sant Agust√≠ de Llu√ßan√®s","Osona"
"Sant Andreu de la Barca","Baix Llobregat"
"Sant Andreu de Llavaneres","Maresme"
"Sant Andreu Salou","Giron√®s"
"Sant Aniol de Finestres","Garrotxa"
"Sant Antoni de Vilamajor","Vall√®s Oriental"
"Sant Bartomeu del Grau","Osona"
"Sant Boi de Llobregat","Baix Llobregat"
"Sant Boi de Llu√ßan√®s","Osona"
"Sant Cebri√† de Vallalta","Maresme"
"Sant Celoni","Vall√®s Oriental"
"Sant Climent de Llobregat","Baix Llobregat"
"Sant Climent Sescebes","Alt Empord√†"
"Sant Cugat del Vall√®s","Vall√®s Occidental"
"Sant Cugat Sesgarrigues","Alt Pened√®s"
"Sant Esteve de la Sarga","Pallars Juss√†"
"Sant Esteve de Palautordera","Vall√®s Oriental"
"Sant Esteve Sesrovires","Baix Llobregat"
"Sant Feliu de Buixalleu","Selva"
"Sant Feliu de Codines","Vall√®s Oriental"
"Sant Feliu de Gu√≠xols","Baix Empord√†"
"Sant Feliu de Llobregat","Baix Llobregat"
"Sant Feliu de Pallerols","Garrotxa"
"Sant Feliu Sasserra","Bages"
"Sant Ferriol","Garrotxa"
"Sant Fost de Campsentelles","Vall√®s Oriental"
"Sant Fruit√≥s de Bages","Bages"
"Sant Gregori","Giron√®s"
"Sant Guim de Freixenet","Segarra"
"Sant Guim de la Plana","Segarra"
"Sant Hilari Sacalm","Selva"
"Sant Hip√≤lit de Voltreg√†","Osona"
"Sant Iscle de Vallalta","Maresme"
"Sant Jaume d'Enveja","Montsi√†"
"Sant Jaume de Frontany√†","Bergued√†"
"Sant Jaume de Llierca","Garrotxa"
"Sant Jaume dels Domenys","Baix Pened√®s"
"Sant Joan de les Abadesses","Ripoll√®s"
"Sant Joan de Mollet","Giron√®s"
"Sant Joan de Vilatorrada","Bages"
"Sant Joan Desp√≠","Baix Llobregat"
"Sant Joan les Fonts","Garrotxa"
"Sant Jordi Desvalls","Giron√®s"
"Sant Juli√† de Cerdanyola","Bergued√†"
"Sant Juli√† de Ramis","Giron√®s"
"Sant Juli√† de Vilatorta","Osona"
"Sant Juli√† del Llor i Bonmat√≠","Selva"
"Sant Just Desvern","Baix Llobregat"
"Sant Lloren√ß d'Hortons","Alt Pened√®s"
"Sant Lloren√ß de la Muga","Alt Empord√†"
"Sant Lloren√ß de Morunys","Solson√®s"
"Sant Lloren√ß Savall","Vall√®s Occidental"
"Sant Mart√≠ d'Albars","Osona"
"Sant Mart√≠ de Centelles","Osona"
"Sant Mart√≠ de Ll√©mena","Giron√®s"
"Sant Mart√≠ de Riucorb","Urgell"
"Sant Mart√≠ de Tous","Anoia"
"Sant Mart√≠ Sarroca","Alt Pened√®s"
"Sant Mart√≠ Sesgueioles","Anoia"
"Sant Mart√≠ Vell","Giron√®s"
"Sant Mateu de Bages","Bages"
"Sant Miquel de Campmajor","Pla de l'Estany"
"Sant Miquel de Fluvi√†","Alt Empord√†"
"Sant Mori","Alt Empord√†"
"Sant Pau de Seg√∫ries","Ripoll√®s"
"Sant Pere de Ribes","Garraf"
"Sant Pere de Riudebitlles","Alt Pened√®s"
"Sant Pere de Torell√≥","Osona"
"Sant Pere de Vilamajor","Vall√®s Oriental"
"Sant Pere Pescador","Alt Empord√†"
"Sant Pere Sallavinera","Anoia"
"Sant Pol de Mar","Maresme"
"Sant Quint√≠ de Mediona","Alt Pened√®s"
"Sant Quirze de Besora","Osona"
"Sant Quirze del Vall√®s","Vall√®s Occidental"
"Sant Quirze Safaja","Moian√®s"
"Sant Ramon","Segarra"
"Sant Sadurn√≠ d'Anoia","Alt Pened√®s"
"Sant Sadurn√≠ d'Osormort","Osona"
"Sant Salvador de Guardiola","Bages"
"Sant Vicen√ß de Castellet","Bages"
"Sant Vicen√ß de Montalt","Maresme"
"Sant Vicen√ß de Torell√≥","Osona"
"Sant Vicen√ß dels Horts","Baix Llobregat"
"Santa B√†rbara","Montsi√†"
"Santa Cec√≠lia de Voltreg√†","Osona"
"Santa Coloma de Cervell√≥","Baix Llobregat"
"Santa Coloma de Farners","Selva"
"Santa Coloma de Gramenet","Barcelon√®s"
"Santa Coloma de Queralt","Conca de Barber√†"
"Santa Cristina d'Aro","Baix Empord√†"
"Santa Eug√®nia de Berga","Osona"
"Santa Eul√†lia de Riuprimer","Osona"
"Santa Eul√†lia de Ron√ßana","Vall√®s Oriental"
"Santa Fe del Pened√®s","Alt Pened√®s"
"Santa Llogaia d'√Älguema","Alt Empord√†"
"Santa Margarida de Montbui","Anoia"
"Santa Margarida i els Monjos","Alt Pened√®s"
"Santa Maria d'Ol√≥","Moian√®s"
"Santa Maria de Besora","Osona"
"Santa Maria de Martorelles","Vall√®s Oriental"
"Santa Maria de Merl√®s","Bergued√†"
"Santa Maria de Miralles","Anoia"
"Santa Maria de Palautordera","Vall√®s Oriental"
"Santa Oliva","Baix Pened√®s"
"Santa Pau","Garrotxa"
"Santa Perp√®tua de Mogoda","Vall√®s Occidental"
"Santa Susanna","Maresme"
"Santpedor","Bages"
"Sarral","Conca de Barber√†"
"Sarri√† de Ter","Giron√®s"
"Sarroca de Bellera","Pallars Juss√†"
"Sarroca de Lleida","Segri√†"
"Saus, Camallera i Llampaies","Alt Empord√†"
"Savall√† del Comtat","Conca de Barber√†"
"Senan","Conca de Barber√†"
"Senterada","Pallars Juss√†"
"Sentmenat","Vall√®s Occidental"
"Seriny√†","Pla de l'Estany"
"Ser√≤s","Segri√†"
"Serra de Dar√≥","Baix Empord√†"
"Setcases","Ripoll√®s"
"Seva","Osona"
"Sidamon","Pla d'Urgell"
"Sils","Selva"
"Sitges","Garraf"
"Siurana","Alt Empord√†"
"Sobremunt","Osona"
"Solivella","Conca de Barber√†"
"Solsona","Solson√®s"
"Sora","Osona"
"Soriguera","Pallars Sobir√†"
"Sort","Pallars Sobir√†"
"Soses","Segri√†"
"Subirats","Alt Pened√®s"
"Sudanell","Segri√†"
"Sunyer","Segri√†"
"S√∫ria","Bages"
"Susqueda","Selva"
"Tagamanent","Vall√®s Oriental"
"Talamanca","Bages"
"Talarn","Pallars Juss√†"
"Talavera","Segarra"
"Taradell","Osona"
"Tarragona","Tarragon√®s"
"T√†rrega","Urgell"
"Tarr√©s","Garrigues"
"Tarroja de Segarra","Segarra"
"Tav√®rnoles","Osona"
"Tavertet","Osona"
"Tei√†","Maresme"
"T√©rmens","Noguera"
"Terrades","Alt Empord√†"
"Terrassa","Vall√®s Occidental"
"Tiana","Maresme"
"T√≠rvia","Pallars Sobir√†"
"Tiurana","Noguera"
"Tivenys","Baix Ebre"
"Tivissa","Ribera d'Ebre"
"Tona","Osona"
"Tor√†","Segarra"
"Tordera","Maresme"
"Torell√≥","Osona"
"Tornabous","Urgell"
"Torre-serona","Segri√†"
"Torrebesses","Segri√†"
"Torredembarra","Tarragon√®s"
"Torrefarrera","Segri√†"
"Torrefeta i Florejacs","Segarra"
"Torregrossa","Pla d'Urgell"
"Torrelameu","Noguera"
"Torrelavit","Alt Pened√®s"
"Torrelles de Foix","Alt Pened√®s"
"Torrelles de Llobregat","Baix Llobregat"
"Torrent","Baix Empord√†"
"Torres de Segre","Segri√†"
"Torroella de Fluvi√†","Alt Empord√†"
"Torroella de Montgr√≠ i l'Estartit","Baix Empord√†"
"Torroja del Priorat","Priorat"
"Tortell√†","Garrotxa"
"Tortosa","Baix Ebre"
"Toses","Ripoll√®s"
"Tossa de Mar","Selva"
"Tremp","Pallars Juss√†"
"Ull√†","Baix Empord√†"
"Ullastrell","Vall√®s Occidental"
"Ullastret","Baix Empord√†"
"Ulldecona","Montsi√†"
"Ulldemolins","Priorat"
"Ultramort","Baix Empord√†"
"Ur√∫s","Cerdanya"
"Vacarisses","Vall√®s Occidental"
"Vall de Card√≥s","Pallars Sobir√†"
"Vall-llobrega","Baix Empord√†"
"Vallbona d'Anoia","Anoia"
"Vallbona de les Monges","Urgell"
"Vallcebre","Bergued√†"
"Vallclara","Conca de Barber√†"
"Vallfogona de Balaguer","Noguera"
"Vallfogona de Ripoll√®s","Ripoll√®s"
"Vallfogona de Riucorb","Conca de Barber√†"
"Vallgorguina","Vall√®s Oriental"
"Vallirana","Baix Llobregat"
"Vallmoll","Alt Camp"
"Vallromanes","Vall√®s Oriental"
"Valls","Alt Camp"
"Vandell√≤s i l'Hospitalet de l'Infant","Baix Camp"
"Veciana","Anoia"
"Ventall√≥","Alt Empord√†"
"Verd√∫","Urgell"
"Verges","Baix Empord√†"
"Vespella de Gai√†","Tarragon√®s"
"Vic","Osona"
"Vidr√†","Osona"
"Vidreres","Selva"
"Vielha e Mijaran","Val d'Aran"
"Vila-rodona","Alt Camp"
"Vila-sacra","Alt Empord√†"
"Vila-sana","Pla d'Urgell"
"Vila-seca","Tarragon√®s"
"Vilabella","Alt Camp"
"Vilabertran","Alt Empord√†"
"Vilablareix","Giron√®s"
"Vilada","Bergued√†"
"Viladamat","Alt Empord√†"
"Viladasens","Giron√®s"
"Viladecans","Baix Llobregat"
"Viladecavalls","Vall√®s Occidental"
"Vilademuls","Pla de l'Estany"
"Viladrau","Osona"
"Vilafant","Alt Empord√†"
"Vilafranca del Pened√®s","Alt Pened√®s"
"Vilagrassa","Urgell"
"Vilaju√Øga","Alt Empord√†"
"Vilalba dels Arcs","Terra Alta"
"Vilalba Sasserra","Vall√®s Oriental"
"Vilaller","Alta Ribagor√ßa"
"Vilallonga de Ter","Ripoll√®s"
"Vilallonga del Camp","Tarragon√®s"
"Vilamacolum","Alt Empord√†"
"Vilamalla","Alt Empord√†"
"Vilamaniscle","Alt Empord√†"
"Vilam√≤s","Val d'Aran"
"Vilanant","Alt Empord√†"
"Vilanova d'Escornalbou","Baix Camp"
"Vilanova de Bellpuig","Pla d'Urgell"
"Vilanova de l'Aguda","Noguera"
"Vilanova de la Barca","Segri√†"
"Vilanova de Mei√†","Noguera"
"Vilanova de Prades","Conca de Barber√†"
"Vilanova de Sau","Osona"
"Vilanova de Segri√†","Segri√†"
"Vilanova del Cam√≠","Anoia"
"Vilanova del Vall√®s","Vall√®s Oriental"
"Vilanova i la Geltr√∫","Garraf"
"Vilaplana","Baix Camp"
"Vilassar de Dalt","Maresme"
"Vilassar de Mar","Maresme"
"Vila√ºr","Alt Empord√†"
"Vilaverd","Conca de Barber√†"
"Vilob√≠ d'Onyar","Selva"
"Vilob√≠ del Pened√®s","Alt Pened√®s"
"Vilopriu","Baix Empord√†"
"Vimbod√≠ i Poblet","Conca de Barber√†"
"Vinaixa","Garrigues"
"Vinebre","Ribera d'Ebre"
"Vinyols i els Arcs","Baix Camp"
"Viver i Serrateix","Bergued√†"
"Xerta","Baix Ebre"`;

async function seed() {
    const lines = RawCSV.trim().split("\n").slice(1);
    const total = lines.length;
    console.log(`üöÄ Iniciant seed de ${total} municipis...`);

    // Batch entries for performance
    const batchSize = 100;
    for (let i = 0; i < lines.length; i += batchSize) {
        const batchLines = lines.slice(i, i + batchSize);
        const entries = batchLines.map(line => {
            // Regex per capturar text entre cometes
            const match = line.match(/"([^"]+)"\s*,\s*"([^"]+)"/);
            if (!match) return null;

            const [_, nom, comarca] = match;
            return {
                nom,
                comarca,
                nom_normalitzat: normalizePlace(nom),
                pais: "ES",
                region: "Catalunya"
            };
        }).filter(Boolean);

        if (entries.length === 0) continue;

        const { error } = await supabase
            .from("municipis")
            .upsert(entries, {
                onConflict: "nom_normalitzat, pais, region"
            });

        if (error) {
            console.error(`‚ùå Error al batch starting at ${i}:`, error.message);
        } else {
            console.log(`‚úÖ Processats ${Math.min(i + batchSize, total)}/${total}...`);
        }
    }

    console.log("‚ú® Seed finalitzat corectament!");
}

seed().catch(err => {
    console.error("Fatal Error:", err);
    process.exit(1);
});
